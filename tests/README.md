# PRPC æµ‹è¯•å¥—ä»¶

è¿™ä¸ªç›®å½•åŒ…å«äº†PRPCé¡¹ç›®çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚

## ğŸ“ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ CMakeLists.txt          # æµ‹è¯•æ„å»ºé…ç½®
â”œâ”€â”€ README.md              # æœ¬æ–‡æ¡£
â”œâ”€â”€ run_tests.sh           # æµ‹è¯•è¿è¡Œè„šæœ¬
â”œâ”€â”€ test_config.cc         # é…ç½®æ¨¡å—æµ‹è¯•
â”œâ”€â”€ test_logger.cc         # æ—¥å¿—æ¨¡å—æµ‹è¯•
â”œâ”€â”€ test_threadpool.cc     # çº¿ç¨‹æ± æ¨¡å—æµ‹è¯•
â”œâ”€â”€ test_network_utils.cc  # ç½‘ç»œå·¥å…·æµ‹è¯•
â”œâ”€â”€ test_error_handling.cc # é”™è¯¯å¤„ç†æµ‹è¯•
â”œâ”€â”€ test_application.cc    # åº”ç”¨ç¨‹åºæ¨¡å—æµ‹è¯•
â”œâ”€â”€ test_integration.cc    # é›†æˆæµ‹è¯•
â””â”€â”€ performance_test.cc    # æ€§èƒ½æµ‹è¯•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# è¿›å…¥æµ‹è¯•ç›®å½•
cd tests

# è¿è¡Œæµ‹è¯•è„šæœ¬
./run_tests.sh
```

### æ‰‹åŠ¨æ„å»ºå’Œè¿è¡Œ

```bash
# ä»é¡¹ç›®æ ¹ç›®å½•
mkdir -p build && cd build
cmake ..
make

# è¿è¡Œå•ä¸ªæµ‹è¯•
./tests/test_config
./tests/test_logger
./tests/test_threadpool
# ... å…¶ä»–æµ‹è¯•

# è¿è¡Œæ€§èƒ½æµ‹è¯•
./tests/performance_test
```

### ä½¿ç”¨CTest

```bash
cd build
ctest --output-on-failure
```

## ğŸ“‹ æµ‹è¯•æ¨¡å—è¯¦æƒ…

### 1. é…ç½®æ¨¡å—æµ‹è¯• (`test_config.cc`)

æµ‹è¯•å†…å®¹ï¼š
- âœ… æœ‰æ•ˆé…ç½®æ–‡ä»¶åŠ è½½
- âœ… æ— æ•ˆé…ç½®æ–‡ä»¶å¤„ç†
- âœ… ç‰¹æ®Šå­—ç¬¦å’Œæ ¼å¼å¤„ç†
- âœ… æ³¨é‡Šå’Œç©ºè¡Œå¤„ç†
- âœ… é…ç½®é‡æ–°åŠ è½½

### 2. æ—¥å¿—æ¨¡å—æµ‹è¯• (`test_logger.cc`)

æµ‹è¯•å†…å®¹ï¼š
- âœ… åŸºæœ¬æ—¥å¿—è®°å½•
- âœ… æ—¥å¿—çº§åˆ«æ§åˆ¶
- âœ… çº¿ç¨‹å®‰å…¨æ€§
- âœ… LogStreamåŠŸèƒ½
- âœ… å•ä¾‹æ¨¡å¼
- âœ… æ—¥å¿—æ ¼å¼åŒ–
- âœ… æ€§èƒ½æµ‹è¯•

### 3. çº¿ç¨‹æ± æµ‹è¯• (`test_threadpool.cc`)

æµ‹è¯•å†…å®¹ï¼š
- âœ… åŸºæœ¬ä»»åŠ¡æäº¤
- âœ… å¤šä»»åŠ¡å¹¶å‘æ‰§è¡Œ
- âœ… å¸¦å‚æ•°çš„ä»»åŠ¡
- âœ… å¼‚å¸¸å¤„ç†
- âœ… ä¸åŒè¿”å›ç±»å‹
- âœ… çº¿ç¨‹æ± é”€æ¯
- âœ… æ€§èƒ½æµ‹è¯•

### 4. ç½‘ç»œå·¥å…·æµ‹è¯• (`test_network_utils.cc`)

æµ‹è¯•å†…å®¹ï¼š
- âœ… Socketåˆ›å»ºå’Œé…ç½®
- âœ… åœ°å€ç±»åŠŸèƒ½
- âœ… ç§»åŠ¨è¯­ä¹‰
- âœ… æœåŠ¡å™¨-å®¢æˆ·ç«¯è¿æ¥
- âœ… æ•°æ®ä¼ è¾“
- âœ… è¶…æ—¶å¤„ç†
- âœ… éé˜»å¡æ¨¡å¼
- âœ… é”™è¯¯å¤„ç†

### 5. é”™è¯¯å¤„ç†æµ‹è¯• (`test_error_handling.cc`)

æµ‹è¯•å†…å®¹ï¼š
- âœ… Resultç±»åŠŸèƒ½
- âœ… å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„
- âœ… ErrorHandleråŠŸèƒ½
- âœ… RAIIèµ„æºç®¡ç†
- âœ… å…¨å±€é”™è¯¯å¤„ç†å™¨
- âœ… å®‰å…¨æ‰§è¡Œå‡½æ•°

### 6. åº”ç”¨ç¨‹åºæµ‹è¯• (`test_application.cc`)

æµ‹è¯•å†…å®¹ï¼š
- âœ… å•ä¾‹æ¨¡å¼
- âœ… åˆå§‹åŒ–æµç¨‹
- âœ… å‚æ•°è§£æ
- âœ… é…ç½®è®¿é—®
- âœ… é”™è¯¯ä¼ æ’­
- âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†

### 7. é›†æˆæµ‹è¯• (`test_integration.cc`)

æµ‹è¯•å†…å®¹ï¼š
- âœ… åº”ç”¨ç¨‹åº-é…ç½®é›†æˆ
- âœ… é”™è¯¯å¤„ç†é›†æˆ
- âœ… æ—¥å¿—é›†æˆ
- âœ… ç½‘ç»œ-é”™è¯¯é›†æˆ
- âœ… ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
- âœ… å¹¶å‘æ“ä½œ
- âœ… èµ„æºç®¡ç†
- âœ… ç«¯åˆ°ç«¯åœºæ™¯

### 8. æ€§èƒ½æµ‹è¯• (`performance_test.cc`)

æµ‹è¯•å†…å®¹ï¼š
- âš¡ çº¿ç¨‹æ± æ€§èƒ½
- âš¡ æ—¥å¿—è®°å½•æ€§èƒ½
- âš¡ é”™è¯¯å¤„ç†æ€§èƒ½
- âš¡ å¹¶å‘æ—¥å¿—æ€§èƒ½
- âš¡ å†…å­˜ä½¿ç”¨æµ‹è¯•
- âš¡ ç½‘ç»œæ€§èƒ½
- âš¡ å¯æ‰©å±•æ€§æµ‹è¯•
- âš¡ å‹åŠ›æµ‹è¯•

## ğŸ“Š æµ‹è¯•ç»“æœç¤ºä¾‹

```
=========================================
           PRPC Test Suite
=========================================
Building project...
Build successful!

=========================================
           Running Tests
=========================================

-----------------------------------------
Running test_config...
-----------------------------------------
Testing valid config loading...
Valid config loading test passed!
Testing invalid config loading...
Invalid config loading test passed!
...
âœ… test_config PASSED

-----------------------------------------
Running test_logger...
-----------------------------------------
Testing basic logging...
Basic logging test passed!
...
âœ… test_logger PASSED

...

=========================================
           Test Results Summary
=========================================
Total tests: 7
Passed: 7
Failed: 0

ğŸ‰ All tests passed!
```

## ğŸ”§ è‡ªå®šä¹‰æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•

1. åˆ›å»ºæ–°çš„æµ‹è¯•æ–‡ä»¶ `test_your_module.cc`
2. åœ¨ `CMakeLists.txt` ä¸­æ·»åŠ åˆ° `TEST_SOURCES`
3. åœ¨ `run_tests.sh` ä¸­æ·»åŠ åˆ° `TESTS` æ•°ç»„

### æµ‹è¯•æ¨¡æ¿

```cpp
#include "your_module.h"
#include <iostream>
#include <cassert>

class YourModuleTest {
public:
    static void testBasicFunctionality() {
        std::cout << "Testing basic functionality..." << std::endl;
        
        // ä½ çš„æµ‹è¯•ä»£ç 
        assert(condition);
        
        std::cout << "Basic functionality test passed!" << std::endl;
    }
};

int main() {
    std::cout << "Starting your module tests..." << std::endl;
    
    try {
        YourModuleTest::testBasicFunctionality();
        
        std::cout << "All your module tests passed!" << std::endl;
        return 0;
        
    } catch (const std::exception& e) {
        std::cerr << "Test failed: " << e.what() << std::endl;
        return 1;
    }
}
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼–è¯‘é”™è¯¯**
   - ç¡®ä¿æ‰€æœ‰ä¾èµ–åº“å·²å®‰è£…
   - æ£€æŸ¥CMakeç‰ˆæœ¬ (éœ€è¦3.10+)
   - éªŒè¯C++17æ”¯æŒ

2. **æµ‹è¯•å¤±è´¥**
   - æ£€æŸ¥ç³»ç»Ÿèµ„æºï¼ˆç«¯å£å ç”¨ã€æ–‡ä»¶æƒé™ç­‰ï¼‰
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
   - ç¡®ä¿ZooKeeperç­‰å¤–éƒ¨æœåŠ¡å¯ç”¨

3. **æ€§èƒ½æµ‹è¯•å¼‚å¸¸**
   - æ€§èƒ½æµ‹è¯•ç»“æœå¯èƒ½å› ç³»ç»Ÿè´Ÿè½½è€Œå˜åŒ–
   - ç½‘ç»œæµ‹è¯•å¯èƒ½å› é˜²ç«å¢™è®¾ç½®è€Œå¤±è´¥
   - è¿™äº›é€šå¸¸ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

### è°ƒè¯•æŠ€å·§

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•å¹¶æŸ¥çœ‹è¯¦ç»†è¾“å‡º
./tests/test_config

# ä½¿ç”¨gdbè°ƒè¯•
gdb ./tests/test_config
(gdb) run
(gdb) bt  # æŸ¥çœ‹å †æ ˆ

# ä½¿ç”¨valgrindæ£€æŸ¥å†…å­˜æ³„æ¼
valgrind --leak-check=full ./tests/test_config
```

## ğŸ“ˆ æŒç»­é›†æˆ

æµ‹è¯•å¥—ä»¶è®¾è®¡ä¸ºå¯ä»¥è½»æ¾é›†æˆåˆ°CI/CDæµç¨‹ä¸­ï¼š

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run Tests
  run: |
    cd tests
    ./run_tests.sh
```

## ğŸ¯ æµ‹è¯•è¦†ç›–ç‡

å½“å‰æµ‹è¯•è¦†ç›–äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š
- âœ… é…ç½®ç®¡ç† (100%)
- âœ… æ—¥å¿—ç³»ç»Ÿ (100%)
- âœ… çº¿ç¨‹æ±  (100%)
- âœ… é”™è¯¯å¤„ç† (100%)
- âœ… ç½‘ç»œå·¥å…· (95%)
- âœ… åº”ç”¨ç¨‹åºæ¡†æ¶ (90%)
- âœ… é›†æˆåœºæ™¯ (85%)

## ğŸ“ è´¡çŒ®æŒ‡å—

æ·»åŠ æ–°æµ‹è¯•æ—¶è¯·éµå¾ªï¼š
1. ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
2. åŒ…å«æ­£é¢å’Œè´Ÿé¢æµ‹è¯•ç”¨ä¾‹
3. æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†æµ‹è¯•
4. æ›´æ–°æ–‡æ¡£
5. ç¡®ä¿æµ‹è¯•æ˜¯ç¡®å®šæ€§çš„ï¼ˆå¯é‡å¤ï¼‰

---

**æ³¨æ„**: æŸäº›æµ‹è¯•ï¼ˆç‰¹åˆ«æ˜¯ç½‘ç»œç›¸å…³çš„ï¼‰å¯èƒ½å› ä¸ºç³»ç»Ÿç¯å¢ƒè€Œä¸ç¨³å®šã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•åº”è¯¥å§‹ç»ˆé€šè¿‡ã€‚ 